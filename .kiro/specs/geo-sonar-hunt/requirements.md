# 要件ドキュメント

## 概要

Geo Sonar Huntは、現実世界の探索と魅力的なゲームプレイメカニクスを組み合わせたiOS向けGPSベースの宝探しゲームです。MVP版は完全にオフラインでローカルデータを使用して動作し、ダウジング（方向案内）とソナー（距離フィードバック）メカニクスを通じてシンプルでありながら魅力的な宝探し体験をユーザーに提供します。このアプリは、位置情報ベースのゲームを楽しみ、公園などの屋外環境で短時間のゲームセッションを好む10-30歳のユーザーをターゲットとしています。

## 要件

### 要件1: マップと宝物管理

**ユーザーストーリー:** プレイヤーとして、事前設定された宝の地図から選択できるようにして、セットアップなしですぐに探索を開始したい。

#### 受入基準

1. アプリが起動したとき、システムは5つのデフォルト宝の地図のリストを表示する
2. ユーザーが地図を選択したとき、システムはローカルストレージから関連する宝の位置を読み込む
3. 宝の位置が読み込まれたとき、システムは地図表示から宝の位置を隠す
4. 宝のデータがローカルに保存されている場合、システムは東京の公共公園エリア用のJSONファイルまたはハードコードされた座標を使用する
5. 地図を表示するとき、システムは地図レンダリングにApple MapKitを使用する

### 要件2: GPS位置追跡

**ユーザーストーリー:** プレイヤーとして、探索メカニクスが適切に動作するように正確なリアルタイム位置追跡を求める。

#### 受入基準

1. アプリが探索モードを開始するとき、システムは「アプリ使用中のみ」の位置情報許可を要求する
2. 位置情報許可が付与されたとき、システムは1秒以内にユーザー位置を更新する
3. GPS信号が弱いとき、システムはユーザーに警告メッセージを表示する
4. アプリがバックグラウンドになったとき、システムはバッテリー保護のため位置追跡を一時停止する
5. 位置情報サービスが無効の場合、システムは明確な指示とともにユーザーに有効化を促す

### 要件3: ダウジングモードナビゲーション

**ユーザーストーリー:** プレイヤーとして、コンパスのようなフィードバックを使用して効果的にナビゲートできるよう、宝への方向案内を求める。

#### 受入基準

1. ダウジングモードがアクティブなとき、システムは最も近い宝に向かう矢印または針を表示する
2. ユーザーの向きが変わったとき、システムは0.5秒以内に方向インジケーターを更新する
3. ユーザーが宝に近づいたとき、システムは正確な方向案内を維持する
4. 複数の宝が存在するとき、システムは最も近い未発見の宝を指す
5. デバイスのコンパスが利用できない場合、システムはエラーメッセージを表示してダウジングモードを無効にする

### 要件4: ソナーモード距離フィードバック

**ユーザーストーリー:** プレイヤーとして、ソナーピングを送信したときに距離ベースのフィードバックを受けて、宝への近さを測りたい。

#### 受入基準

1. ユーザーがソナーボタンをタップしたとき、システムは最も近い宝への距離を計算する
2. 距離が100m以上のとき、システムは弱い音響ビープと最小限の振動を提供する
3. 距離が50-100mのとき、システムは中程度の音響ビープと適度な振動を提供する
4. 距離が10-50mのとき、システムは強い音響ビープと強い振動を提供する
5. 距離が10m未満のとき、システムは連続ビープと激しい振動を提供する
6. ソナーがアクティブになったとき、システムは距離に対応する視覚フィードバック（パルスアニメーション）を表示する

### 要件5: モード切り替え

**ユーザーストーリー:** プレイヤーとして、異なる探索戦略を使用できるよう、ダウジングモードとソナーモードを切り替えたい。

#### 受入基準

1. 探索ビューにいるとき、システムはダウジングモードとソナーモード用のトグルボタンを表示する
2. ユーザーがモードを切り替えたとき、システムは0.2秒以内にインターフェースを更新する
3. ダウジングモードが選択されたとき、システムはソナーコントロールを隠し、方向インジケーターを表示する
4. ソナーモードが選択されたとき、システムは方向インジケーターを隠し、ソナーボタンを表示する
5. モード切り替えが発生したとき、システムは現在の位置追跡を中断することなく維持する

### 要件6: 宝物発見

**ユーザーストーリー:** プレイヤーとして、宝を見つけたときに達成感と報酬を感じられるよう、明確なフィードバックを求める。

#### 受入基準

1. ユーザーが宝から10メートル以内にいるとき、システムは宝物発見をトリガーする
2. 宝が発見されたとき、システムは祝賀アニメーションを表示する
3. 宝が見つかったとき、システムは成功音効果を再生する
4. 発見が発生したとき、システムはユーザーのローカルスコアにポイントを追加する
5. 宝が収集されたとき、システムはそれを発見済みとしてマークし、アクティブターゲットから削除する
6. 地図上のすべての宝が見つかったとき、システムは完了メッセージを表示する

### 要件7: ローカル進捗追跡

**ユーザーストーリー:** プレイヤーとして、アプリセッション間で宝探しを継続できるよう、進捗をローカルに保存したい。

#### 受入基準

1. 宝が発見されたとき、システムは発見をローカルストレージ（UserDefaults）に保存する
2. アプリが再開されたとき、システムは以前の進捗を読み込み、発見された宝を完了として表示する
3. ポイントが獲得されたとき、システムは総スコアをローカルで増加させ、永続化する
4. ユーザーが実績を完了したとき、システムはバッジ/マイルストーンデータをローカルに保存する
5. ローカルデータが破損した場合、システムはクラッシュすることなく初期状態にリセットする

### 要件8: オーディオとハプティック設定

**ユーザーストーリー:** プレイヤーとして、環境に合わせて体験をカスタマイズできるよう、オーディオと振動設定をコントロールしたい。

#### 受入基準

1. 設定にアクセスするとき、システムはゲームオーディオ用のボリュームスライダーを提供する
2. 設定にアクセスするとき、システムはハプティックフィードバック用のトグルを提供する
3. オーディオが無効のとき、システムは視覚とハプティックフィードバックのみに依存する
4. ハプティックが無効のとき、システムはオーディオと視覚フィードバックのみに依存する
5. 設定が変更されたとき、システムは即座に変更を適用し、設定をローカルに保存する

### 要件9: チュートリアルとオンボーディング

**ユーザーストーリー:** 新しいプレイヤーとして、ゲームメカニクスを素早く理解できるよう、プレイ方法の明確な指示を求める。

#### 受入基準

1. アプリが初回起動したとき、システムはチュートリアルシーケンスを表示する
2. チュートリアルがアクティブなとき、システムは視覚的デモンストレーションでダウジングモードを説明する
3. チュートリアルが続くとき、システムはインタラクティブな例でソナーモードを説明する
4. チュートリアルが完了したとき、システムはそれを既読としてマークし、再表示しない
5. ユーザーがチュートリアルをスキップしたとき、システムは設定でヘルプ情報へのアクセスを提供する

### 要件10: オフライン動作

**ユーザーストーリー:** プレイヤーとして、GPS信号がある場所ならどこでもプレイできるよう、インターネット接続なしでゲームが動作することを求める。

#### 受入基準

1. アプリが開始するとき、システムはインターネット接続なしで完全に機能する
2. ネットワークが利用できないとき、システムはローカルデータを使用して通常動作を継続する
3. GPSは利用可能だがネットワークが利用できないとき、システムは完全なゲームプレイ機能を提供する
4. 地図タイルが必要なとき、システムはキャッシュされたまたはシステム提供の地図データを使用する
5. 重要なローカルデータが欠落している場合、システムは適切なエラーメッセージと優雅な劣化を表示する