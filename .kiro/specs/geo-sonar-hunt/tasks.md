# 実装計画

- [x] 1. プロジェクト基盤とツールチェーンのセットアップ
  - XcodeGenプロジェクト設定ファイル（project.yml）を作成
  - SPMローカルパッケージ構造を構築（GeoSonarCore、GeoSonarUI、GeoSonarTesting）
  - Swift 6とSwift Testingフレームワークの設定
  - 基本的なCI/CDパイプライン設定（GitHub Actions）
  - _要件: 10.1, 10.2, 10.3_

- [x] 2. コアデータモデルの実装（TDD）
  - [x] 2.1 基本データモデルのテストとインターフェース作成
    - TreasureMap、Treasure、GameSessionモデルのテストを先に作成
    - Codableプロトコル準拠とJSONシリアライゼーションのテスト
    - データ検証ロジックのテスト実装
    - _要件: 1.1, 1.2, 7.1_

  - [x] 2.2 データモデルの実装
    - テストを通すためのTreasureMap構造体実装
    - Treasure構造体とdiscoveryRadius検証ロジック実装
    - GameSession構造体と進捗追跡機能実装
    - _要件: 1.1, 1.2, 6.5, 7.1_

- [x] 3. Repository層の実装（TDD）
  - [x] 3.1 Repository プロトコルとモックの作成
    - TreasureMapRepositoryプロトコル定義
    - GameProgressRepositoryプロトコル定義
    - テスト用モック実装（GeoSonarTestingパッケージ）
    - _要件: 1.2, 7.1, 7.2_

  - [x] 3.2 LocalTreasureMapRepositoryの実装
    - JSONファイルからの地図データ読み込みテスト作成
    - 東京公園エリアのサンプルデータ作成
    - エラーハンドリング（データ破損、ファイル不存在）のテスト
    - Repository実装でテストを通す
    - _要件: 1.1, 1.4, 1.5_

  - [x] 3.3 LocalGameProgressRepositoryの実装
    - UserDefaultsを使用した進捗保存のテスト作成
    - 発見済み宝物の永続化テスト
    - スコア計算と保存のテスト
    - Repository実装でテストを通す
    - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 4. 位置情報サービスの実装（TDD）
  - [x] 4.1 LocationServiceのテストとプロトコル作成
    - 位置情報許可要求のテスト作成
    - リアルタイム位置更新のテスト作成
    - バックグラウンド処理とバッテリー最適化のテスト
    - LocationServiceProtocolとMockLocationService実装
    - _要件: 2.1, 2.2, 2.4_

  - [x] 4.2 LocationServiceの実装
    - CLLocationManagerを使用した実装
    - Swift 6の並行性チェックに対応した@MainActor実装
    - エラーハンドリング（GPS信号弱、許可拒否）
    - テストを通すための実装完成
    - _要件: 2.1, 2.2, 2.3, 2.5_

- [x] 5. 探索メカニクスの実装（TDD）
  - [x] 5.1 ExplorationServiceのテストと基本実装
    - 距離計算アルゴリズムのテスト作成（複数のテストケース）
    - 方向計算（ダウジング）のテスト作成
    - 宝発見検出ロジックのテスト作成
    - ExplorationService基本実装
    - _要件: 3.1, 3.2, 3.3, 4.1, 6.1_

  - [x] 5.2 FeedbackServiceの実装
    - ソナーフィードバック（音響・振動・視覚）のテスト作成
    - 距離に応じたフィードバック強度のテスト
    - AVFoundationとHapticFeedbackの統合テスト
    - FeedbackService実装でテストを通す
    - _要件: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [x] 6. ViewModelレイヤーの実装（TDD）
  - [x] 6.1 MapSelectionViewModelの実装
    - 地図リスト表示のテスト作成
    - 地図選択とゲームセッション開始のテスト
    - ローディング状態管理のテスト
    - @Observableマクロを使用したViewModel実装
    - _要件: 1.1, 1.2_

  - [x] 6.2 ExplorationViewModelの実装
    - モード切り替え（ダウジング⇔ソナー）のテスト作成
    - リアルタイム位置更新とUI反映のテスト
    - 宝発見処理とスコア更新のテスト
    - Swift 6の厳格な並行性チェックに対応した実装
    - _要件: 3.1, 3.2, 4.1, 5.1, 5.2, 6.1, 6.2_

- [ ] 7. SwiftUI Views の実装（TDD）
  - [x] 7.1 基本UIコンポーネントの作成
    - MapRowView、ModeToggleView、DowsingCompassViewのテスト作成
    - SwiftUI PreviewとSnapshot testingの設定
    - アクセシビリティ対応のテスト
    - UIコンポーネント実装
    - _要件: 3.1, 3.3, 5.1, 5.2_

  - [x] 7.2 メイン画面の実装
    - MapSelectionViewのUIテスト作成
    - ExplorationViewのUIテスト作成
    - ナビゲーション遷移のテスト
    - SwiftUI Views実装でテストを通す
    - _要件: 1.1, 3.1, 4.1, 5.1, 5.2_

- [x] 8. 設定とオンボーディング機能の実装
  - [x] 8.1 GameSettingsとUserDefaultsの実装
    - 音量・振動設定の永続化テスト作成
    - 設定変更の即座反映テスト
    - 設定画面UIのテスト作成
    - 設定機能の実装
    - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

  - [x] 8.2 チュートリアルシステムの実装
    - 初回起動検出のテスト作成
    - チュートリアル進行管理のテスト
    - スキップ機能とヘルプアクセスのテスト
    - チュートリアル画面とロジックの実装
    - _要件: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 9. エラーハンドリングとユーザビリティの向上
  - [x] 9.1 包括的エラーハンドリングの実装
    - GameErrorタイプとローカライズされたメッセージのテスト
    - 優雅な劣化とフォールバック機能のテスト
    - エラー状態からの自動復旧テスト
    - ErrorHandler実装とUI統合
    - _要件: 2.3, 2.5, 10.4, 10.5_

  - [x] 9.2 パフォーマンス最適化
    - バッテリー消費最適化のテスト作成
    - メモリ使用量監視とリーク検出テスト
    - GPS更新頻度の動的調整テスト
    - 最適化実装とパフォーマンステスト実行
    - _要件: 2.2, 2.4_

- [ ] 10. 統合テストとアプリ全体の結合
  - [x] 10.1 E2Eテストスイートの作成
    - 完全な宝探しフローのUIテスト作成
    - 異なるシナリオ（複数宝発見、設定変更等）のテスト
    - アクセシビリティテストの実装
    - パフォーマンステストの実行と検証
    - _要件: 全要件の統合検証_

  - [x] 10.2 本番リリース準備
    - App Store用アセット（アイコン、スクリーンショット）の準備
    - プライバシーポリシーと位置情報使用説明の作成
    - リリースビルド設定とコード署名
    - 最終的な品質保証テストの実行
    - _要件: 全要件の最終検証_